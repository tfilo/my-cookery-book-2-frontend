import{r as l,u as Q,e as S,A as q,h as z,f as j,j as s,k as C,B as m,S as D,F as v,b as P,c as R,d as H,M as p,z as b}from"./index-Djf207zA.js";import{u as K}from"./useMutation-CYG_XA4X.js";import{T as U}from"./Table-J9FyKPWQ.js";const V=()=>{const[g,d]=l.useState(),[i,h]=l.useState(),x=Q(),o=S(),y=l.useContext(q),{data:c,isFetching:N,error:u}=z({queryKey:["categories"],queryFn:({signal:e})=>b.getCategories({signal:e}).then(a=>a.sort((r,t)=>r.name.localeCompare(t.name,void 0,{sensitivity:"base"})))});l.useEffect(()=>{u&&j(u).then(e=>d(e))},[u]);const k=()=>{x("/category")},E=e=>{x(`/category/${e}`)},w=e=>{h(e)},{mutate:f,isPending:A}=K({mutationFn:e=>b.deleteCategory(e),onMutate:async e=>{await o.cancelQueries({queryKey:["categories"]});const a=o.getQueryData(["categories"]);o.setQueryData(["categories"],n=>n==null?void 0:n.filter(M=>M.id!==e));const r=a==null?void 0:a.find(n=>n.id===e),t=a==null?void 0:a.findIndex(n=>n.id===e);return{removed:r,index:t}},onSuccess:(e,a)=>{o.removeQueries({queryKey:["categories",a]})},onError:(e,a,r)=>{o.setQueryData(["categories"],t=>{if(t&&r&&r.index!==void 0&&r.removed)return[...t.slice(0,r.index),r.removed,...t.slice(r.index)]}),j(e).then(t=>d(t))}}),F=l.useCallback(e=>{e&&i&&f(i.id),h(void 0)},[i,f]);return s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"d-flex flex-column flex-md-row",children:[s.jsx("h1",{className:"flex-grow-1",children:"Kategórie"}),y.userRoles.find(e=>e===C.User.RoleEnum.ADMIN)&&s.jsx(m,{variant:"primary",onClick:k,children:"Pridať kategóriu"})]}),s.jsxs(U,{striped:!0,responsive:!0,children:[s.jsx("thead",{children:s.jsx("tr",{children:s.jsx("th",{colSpan:2,children:"Názov kategórie"})})}),s.jsx("tbody",{children:c==null?void 0:c.map(e=>s.jsxs("tr",{children:[s.jsx("td",{className:"align-middle",children:e.name}),s.jsx("td",{className:"align-middle ",children:y.userRoles.find(a=>a===C.User.RoleEnum.ADMIN)&&s.jsxs(D,{direction:"horizontal",gap:2,className:"justify-content-end",children:[s.jsx(m,{title:"Upraviť","aria-label":"Upraviť",variant:"outline-secondary",onClick:E.bind(null,e.id),className:"border-0",children:s.jsx(v,{icon:P})}),s.jsx(m,{title:"Vymazať","aria-label":"Vymazať",variant:"outline-danger",onClick:w.bind(null,e),className:"border-0",children:s.jsx(v,{icon:R})})]})})]},e.id))})]}),s.jsx(H,{show:N||A}),s.jsx(p,{show:!!i,type:"question",message:`Prajete si vymazať kategóriu "${i==null?void 0:i.name}" ?`,onClose:F}),s.jsx(p,{show:!!g,message:g,type:"error",onClose:()=>{d(void 0)}})]})};export{V as default};
//# sourceMappingURL=CategoriesPage-ChMVLcY5.js.map
