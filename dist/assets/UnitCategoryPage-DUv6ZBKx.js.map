{"version":3,"file":"UnitCategoryPage-DUv6ZBKx.js","sources":["../../src/pages/unitCategories/UnitCategoryPage.tsx"],"sourcesContent":["import React, { useState } from 'react';\nimport { useNavigate, useParams } from 'react-router-dom';\nimport { useForm, SubmitHandler, FormProvider } from 'react-hook-form';\nimport { Button, Form, Stack } from 'react-bootstrap';\nimport { yupResolver } from '@hookform/resolvers/yup';\nimport { useMutation, useQueryClient } from '@tanstack/react-query';\nimport * as yup from 'yup';\nimport { Api } from '../../openapi';\nimport { unitCategoryApi } from '../../utils/apiWrapper';\nimport { formatErrorMessage } from '../../utils/errorMessages';\nimport Input from '../../components/ui/Input';\nimport Modal from '../../components/ui/Modal';\nimport Spinner from '../../components/ui/Spinner';\n\ntype UnitCategoryForm = Api.CreateUnitCategory | Api.UpdateUnitCategory;\n\nconst schema = yup\n    .object({\n        name: yup.string().trim().min(1, 'Musí byť minimálne 1 znak').max(80, 'Musí byť maximálne 80 znakov').required('Povinná položka')\n    })\n    .required();\n\nconst UnitCategoryPage: React.FC = () => {\n    const [error, setError] = useState<string>();\n    const navigate = useNavigate();\n    const params = useParams();\n    const queryClient = useQueryClient();\n\n    const methods = useForm<UnitCategoryForm>({\n        resolver: yupResolver(schema),\n        defaultValues: async () => {\n            if (params.id) {\n                try {\n                    const data = await queryClient.fetchQuery({\n                        queryKey: ['unitcategories', parseInt(params?.id)] as const,\n                        queryFn: ({ queryKey, signal }) => {\n                            return unitCategoryApi.getUnitCategory(queryKey[1], { signal });\n                        }\n                    });\n                    return data;\n                } catch (e) {\n                    formatErrorMessage(e).then((message) => setError(message));\n                }\n            }\n            return {\n                name: ''\n            };\n        }\n    });\n\n    const {\n        formState: { isSubmitting, isLoading }\n    } = methods;\n\n    const cancelHandler = () => {\n        navigate('/units');\n    };\n\n    const { mutate: saveUnitCategory, isPending: isSaving } = useMutation({\n        mutationFn: ({ data, unitCategoryId }: { data: UnitCategoryForm; unitCategoryId?: number }) => {\n            if (unitCategoryId) {\n                return unitCategoryApi.updateUnitCategory(unitCategoryId, data);\n            } else {\n                return unitCategoryApi.createUnitCategory(data);\n            }\n        },\n        onMutate: async () => {\n            await queryClient.cancelQueries({ queryKey: ['unitcategories'] });\n        },\n        onSettled: async (data, error) => {\n            if (error) {\n                formatErrorMessage(error).then((message) => setError(message));\n            } else if (data) {\n                queryClient.setQueryData<Api.UnitCategory>(['unitcategories', data.id], () => data);\n                queryClient.setQueryData<Api.SimpleUnitCategory[]>(['unitcategories'], (unitCategories) => {\n                    const index = unitCategories?.findIndex((c) => c.id === data.id) ?? -1;\n                    if (index > -1) {\n                        const result = [...(unitCategories ?? [])];\n                        result[index] = {\n                            id: data.id,\n                            name: data.name\n                        };\n                        return result.sort((a, b) =>\n                            a.name.localeCompare(b.name, undefined, {\n                                sensitivity: 'base'\n                            })\n                        );\n                    } else {\n                        const result = [\n                            ...(unitCategories ?? []),\n                            {\n                                id: data.id,\n                                name: data.name\n                            }\n                        ];\n                        return result.sort((a, b) =>\n                            a.name.localeCompare(b.name, undefined, {\n                                sensitivity: 'base'\n                            })\n                        );\n                    }\n                });\n                navigate('/units');\n            }\n        }\n    });\n\n    const submitHandler: SubmitHandler<UnitCategoryForm> = (data: UnitCategoryForm) => {\n        saveUnitCategory({\n            data,\n            unitCategoryId: params.id ? parseInt(params.id) : undefined\n        });\n    };\n\n    return (\n        <div className='row justify-content-center'>\n            <div className='col-lg-6 pt-3'>\n                <h1>Kategória jednotiek</h1>\n                <FormProvider {...methods}>\n                    <Form\n                        noValidate\n                        onSubmit={methods.handleSubmit(submitHandler)}\n                    >\n                        <Input\n                            name='name'\n                            label='Názov kategórie jednotiek'\n                        />\n                        <Stack\n                            direction='horizontal'\n                            gap={2}\n                        >\n                            <Button\n                                variant='primary'\n                                type='submit'\n                            >\n                                {params.id ? 'Zmeniť kategóriu' : 'Vytvoriť kategóriu'}\n                            </Button>{' '}\n                            <Button\n                                variant='warning'\n                                type='button'\n                                onClick={cancelHandler}\n                            >\n                                Zrušiť\n                            </Button>\n                        </Stack>\n                    </Form>\n                </FormProvider>\n            </div>\n            <Modal\n                show={!!error}\n                message={error}\n                type='error'\n                onClose={() => {\n                    setError(undefined);\n                }}\n            />\n            <Spinner show={isSubmitting || isLoading || isSaving} />\n        </div>\n    );\n};\n\nexport default UnitCategoryPage;\n"],"names":["schema","yup.object","yup.string","UnitCategoryPage","error","setError","useState","navigate","useNavigate","params","useParams","queryClient","useQueryClient","methods","useForm","yupResolver","queryKey","signal","unitCategoryApi","formatErrorMessage","message","isSubmitting","isLoading","cancelHandler","saveUnitCategory","isSaving","useMutation","data","unitCategoryId","unitCategories","index","c","result","a","b","submitHandler","jsxs","jsx","FormProvider","Form","Input","Stack","Button","Modal","Spinner"],"mappings":"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"}