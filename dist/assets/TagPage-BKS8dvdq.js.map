{"version":3,"file":"TagPage-BKS8dvdq.js","sources":["../../src/pages/tags/TagPage.tsx"],"sourcesContent":["import React, { useState } from 'react';\nimport { useNavigate, useParams } from 'react-router-dom';\nimport { useForm, SubmitHandler, FormProvider } from 'react-hook-form';\nimport { Button, Form, Stack } from 'react-bootstrap';\nimport { yupResolver } from '@hookform/resolvers/yup';\nimport { useMutation, useQueryClient } from '@tanstack/react-query';\nimport * as yup from 'yup';\nimport { Api } from '../../openapi';\nimport { tagApi } from '../../utils/apiWrapper';\nimport { formatErrorMessage } from '../../utils/errorMessages';\nimport Input from '../../components/ui/Input';\nimport Modal from '../../components/ui/Modal';\nimport Spinner from '../../components/ui/Spinner';\n\ntype TagForm = Api.CreateTag | Api.UpdateTag;\n\nconst schema = yup\n    .object({\n        name: yup.string().trim().min(1, 'Musí byť minimálne 1 znak').max(80, 'Musí byť maximálne 80 znakov').required('Povinná položka')\n    })\n    .required();\n\nconst TagPage: React.FC = () => {\n    const [error, setError] = useState<string>();\n    const navigate = useNavigate();\n    const params = useParams();\n    const queryClient = useQueryClient();\n\n    const methods = useForm<TagForm>({\n        resolver: yupResolver(schema),\n        defaultValues: async () => {\n            if (params.id) {\n                try {\n                    const data = await queryClient.fetchQuery({\n                        queryKey: ['tags', parseInt(params?.id)] as const,\n                        queryFn: ({ queryKey, signal }) => {\n                            return tagApi.getTag(queryKey[1], { signal });\n                        }\n                    });\n                    return data;\n                } catch (e) {\n                    formatErrorMessage(e).then((message) => setError(message));\n                }\n            }\n            return {\n                name: ''\n            };\n        }\n    });\n\n    const {\n        formState: { isSubmitting, isLoading }\n    } = methods;\n\n    const cancelHandler = () => {\n        navigate('/tags');\n    };\n\n    const { mutate: saveTag, isPending: isSaving } = useMutation({\n        mutationFn: ({ data, tagId }: { data: TagForm; tagId?: number }) => {\n            if (tagId) {\n                return tagApi.updateTag(tagId, data);\n            } else {\n                return tagApi.createTag(data);\n            }\n        },\n        onMutate: async () => {\n            await queryClient.cancelQueries({ queryKey: ['tags'] });\n        },\n        onSettled: async (data, error) => {\n            if (error) {\n                formatErrorMessage(error).then((message) => setError(message));\n            } else if (data) {\n                queryClient.setQueryData<Api.Tag>(['tags', data.id], () => data);\n                queryClient.setQueryData<Api.SimpleTag[]>(['tags'], (tags) => {\n                    const index = tags?.findIndex((t) => t.id === data.id) ?? -1;\n                    if (index > -1) {\n                        const result = [...(tags ?? [])];\n                        result[index] = {\n                            id: data.id,\n                            name: data.name\n                        };\n                        return result.sort((a, b) =>\n                            a.name.localeCompare(b.name, undefined, {\n                                sensitivity: 'base'\n                            })\n                        );\n                    } else {\n                        const result = [\n                            ...(tags ?? []),\n                            {\n                                id: data.id,\n                                name: data.name\n                            }\n                        ];\n                        return result.sort((a, b) =>\n                            a.name.localeCompare(b.name, undefined, {\n                                sensitivity: 'base'\n                            })\n                        );\n                    }\n                });\n                navigate('/tags');\n            }\n        }\n    });\n\n    const submitHandler: SubmitHandler<TagForm> = (data: TagForm) => {\n        saveTag({\n            data,\n            tagId: params.id ? parseInt(params.id) : undefined\n        });\n    };\n\n    return (\n        <div className='row justify-content-center'>\n            <div className='col-lg-6 pt-3'>\n                <h1>Značka</h1>\n                <FormProvider {...methods}>\n                    <Form\n                        noValidate\n                        onSubmit={methods.handleSubmit(submitHandler)}\n                    >\n                        <Input\n                            name='name'\n                            label='Značka'\n                        />\n                        <Stack\n                            direction='horizontal'\n                            gap={2}\n                        >\n                            <Button\n                                variant='primary'\n                                type='submit'\n                            >\n                                {params.id ? 'Zmeniť značku' : 'Vytvoriť značku'}\n                            </Button>{' '}\n                            <Button\n                                variant='warning'\n                                type='button'\n                                onClick={cancelHandler}\n                            >\n                                Zrušiť\n                            </Button>\n                        </Stack>\n                    </Form>\n                </FormProvider>\n            </div>\n            <Modal\n                show={!!error}\n                message={error}\n                type='error'\n                onClose={() => {\n                    setError(undefined);\n                }}\n            />\n            <Spinner show={isSubmitting || isLoading || isSaving} />\n        </div>\n    );\n};\n\nexport default TagPage;\n"],"names":["schema","yup.object","yup.string","TagPage","error","setError","useState","navigate","useNavigate","params","useParams","queryClient","useQueryClient","methods","useForm","yupResolver","queryKey","signal","tagApi","formatErrorMessage","message","isSubmitting","isLoading","cancelHandler","saveTag","isSaving","useMutation","data","tagId","tags","index","t","result","a","b","submitHandler","jsxs","jsx","FormProvider","Form","Input","Stack","Button","Modal","Spinner"],"mappings":"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"}