import{r as S,u as w,y as P,e as M,n as E,j as t,p as F,o as Q,I as b,C as U,S as z,B as p,M as N,d as $,s as K,i as m,f as x,v as V,a7 as B,w as D,x as h}from"./index-Djf207zA.js";import{u as H}from"./useMutation-CYG_XA4X.js";const Z=V({name:h().trim().max(80,"Musí byť maximálne 80 znakov").required("Povinná položka"),abbreviation:h().trim().max(20,"Musí byť maximálne 20 znakov").required("Povinná položka"),required:D().required("Povinná položka"),unitCategoryId:B().defined().label("Kategória jednotky")}).required(),L=()=>{const[y,o]=S.useState(),v=w(),i=P();if(!i.categoryId)throw new Error("categoryId is required parameter");const u=parseInt(i.categoryId),s=M();console.log(i);const c=E({resolver:K(Z),defaultValues:async()=>{if(i.unitId)try{const e=await s.fetchQuery({queryKey:["unitcategories",u,"units",parseInt(i.unitId)],queryFn:({queryKey:n,signal:r})=>m.getUnit(n[3],{signal:r})});return console.log(e),e}catch(e){x(e).then(n=>o(n))}return{name:"",abbreviation:"",required:!1,unitCategoryId:u}}}),{formState:{isSubmitting:I,isLoading:j}}=c,f=()=>{v("/units")},{mutate:q,isPending:k}=H({mutationFn:({data:e,unitId:n})=>n?m.updateUnit(n,e):m.createUnit(e),onMutate:async({data:e})=>{await s.cancelQueries({queryKey:["unitcategories",e.unitCategoryId,"units"]})},onSettled:async(e,n)=>{n?x(n).then(r=>o(r)):e&&(s.setQueryData(["unitcategories",e.unitCategoryId,"units",e.id],()=>e),s.setQueryData(["unitcategories",e.unitCategoryId,"units"],r=>{const g=(r==null?void 0:r.findIndex(a=>a.id===e.id))??-1;if(g>-1){const a=[...r??[]];return a[g]={id:e.id,name:e.name,abbreviation:e.abbreviation,required:e.required},a.sort((d,l)=>d.name.localeCompare(l.name,void 0,{sensitivity:"base"}))}else return[...r??[],{id:e.id,name:e.name,abbreviation:e.abbreviation,required:e.required}].sort((d,l)=>d.name.localeCompare(l.name,void 0,{sensitivity:"base"}))}),v("/units"))}}),C=e=>{q({data:{...e,unitCategoryId:u},unitId:i.unitId?parseInt(i.unitId):void 0})};return t.jsxs("div",{className:"row justify-content-center",children:[t.jsxs("div",{className:"col-lg-6 pt-3",children:[t.jsx("h1",{children:"Jednotka"}),t.jsx(F,{...c,children:t.jsxs(Q,{noValidate:!0,onSubmit:c.handleSubmit(C),children:[t.jsx(b,{name:"name",label:"Názov jednotky"}),t.jsx(b,{name:"abbreviation",label:"Skratka"}),t.jsx(U,{name:"required",label:"Povinná hodnota"}),t.jsxs(z,{direction:"horizontal",gap:2,children:[t.jsx(p,{variant:"primary",type:"submit",children:i.unitId?"Zmeniť jednotku":"Vytvoriť jednotku"})," ",t.jsx(p,{variant:"warning",type:"button",onClick:f,children:"Zrušiť"})]})]})})]}),t.jsx(N,{show:!!y,message:y,type:"error",onClose:()=>{o(void 0)}}),t.jsx($,{show:I||j||k})]})};export{L as default};
//# sourceMappingURL=UnitPage-BuTrIaQi.js.map
