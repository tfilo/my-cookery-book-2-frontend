{"version":3,"file":"CategoriesPage-ChMVLcY5.js","sources":["../../src/pages/categories/CategoriesPage.tsx"],"sourcesContent":["import React, { useEffect, useState, useContext, useCallback } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { Button, Stack, Table } from 'react-bootstrap';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { faPencil, faTrash } from '@fortawesome/free-solid-svg-icons';\nimport { useMutation, useQuery, useQueryClient } from '@tanstack/react-query';\nimport { Api } from '../../openapi';\nimport { AuthContext } from '../../store/auth-context';\nimport { categoryApi } from '../../utils/apiWrapper';\nimport { formatErrorMessage } from '../../utils/errorMessages';\nimport Modal from '../../components/ui/Modal';\nimport Spinner from '../../components/ui/Spinner';\n\nconst CategoriesPage: React.FC = () => {\n    const [error, setError] = useState<string>();\n    const [category, setCategory] = useState<Api.SimpleCategory>();\n    const navigate = useNavigate();\n    const queryClient = useQueryClient();\n    const authCtx = useContext(AuthContext);\n\n    const {\n        data: listOfCategories,\n        isFetching: isFetchingListOfCategories,\n        error: listOfCategoriesError\n    } = useQuery({\n        queryKey: ['categories'],\n        queryFn: ({ signal }) =>\n            categoryApi.getCategories({ signal }).then((data) =>\n                data.sort((a, b) =>\n                    a.name.localeCompare(b.name, undefined, {\n                        sensitivity: 'base'\n                    })\n                )\n            )\n    });\n\n    useEffect(() => {\n        if (listOfCategoriesError) {\n            formatErrorMessage(listOfCategoriesError).then((message) => setError(message));\n        }\n    }, [listOfCategoriesError]);\n\n    const createCategoryHandler = () => {\n        navigate('/category');\n    };\n\n    const editCategoryHandler = (id: number) => {\n        navigate(`/category/${id}`);\n    };\n\n    const deleteCategoryHandler = (category: Api.SimpleCategory) => {\n        setCategory(category);\n    };\n\n    const { mutate: deleteCategory, isPending: isDeleteingCategory } = useMutation({\n        mutationFn: (categoryId: number) => categoryApi.deleteCategory(categoryId),\n        onMutate: async (categoryId) => {\n            await queryClient.cancelQueries({ queryKey: ['categories'] });\n            const categories = queryClient.getQueryData<Api.SimpleCategory[]>(['categories']);\n            queryClient.setQueryData<Api.SimpleCategory[]>(['categories'], (old) => old?.filter((c) => c.id !== categoryId));\n            const removed = categories?.find((c) => c.id === categoryId);\n            const index = categories?.findIndex((c) => c.id === categoryId);\n            return {\n                removed,\n                index\n            };\n        },\n        onSuccess: (data, categoryId) => {\n            queryClient.removeQueries({\n                queryKey: ['categories', categoryId]\n            });\n        },\n        onError: (error, categoryId, context) => {\n            queryClient.setQueryData<Api.SimpleCategory[]>(['categories'], (old) => {\n                if (old && context && context.index !== undefined && context.removed) {\n                    return [...old.slice(0, context.index), context.removed, ...old.slice(context.index)];\n                }\n                return undefined;\n            });\n            formatErrorMessage(error).then((message) => setError(message));\n        }\n    });\n\n    const deleteCategoryConfirmHandler = useCallback(\n        (confirmed: boolean) => {\n            if (confirmed) {\n                if (category) {\n                    deleteCategory(category.id);\n                }\n            }\n            setCategory(undefined);\n        },\n        [category, deleteCategory]\n    );\n\n    return (\n        <>\n            <div className='d-flex flex-column flex-md-row'>\n                <h1 className='flex-grow-1'>Kategórie</h1>\n                {authCtx.userRoles.find((role) => role === Api.User.RoleEnum.ADMIN) && (\n                    <Button\n                        variant='primary'\n                        onClick={createCategoryHandler}\n                    >\n                        Pridať kategóriu\n                    </Button>\n                )}\n            </div>\n            <Table\n                striped\n                responsive\n            >\n                <thead>\n                    <tr>\n                        <th colSpan={2}>Názov kategórie</th>\n                    </tr>\n                </thead>\n                <tbody>\n                    {listOfCategories?.map((category) => (\n                        <tr key={category.id}>\n                            <td className='align-middle'>{category.name}</td>\n                            <td className='align-middle '>\n                                {authCtx.userRoles.find((role) => role === Api.User.RoleEnum.ADMIN) && (\n                                    <Stack\n                                        direction='horizontal'\n                                        gap={2}\n                                        className='justify-content-end'\n                                    >\n                                        <Button\n                                            title='Upraviť'\n                                            aria-label='Upraviť'\n                                            variant='outline-secondary'\n                                            onClick={editCategoryHandler.bind(null, category.id)}\n                                            className='border-0'\n                                        >\n                                            <FontAwesomeIcon icon={faPencil} />\n                                        </Button>\n\n                                        <Button\n                                            title='Vymazať'\n                                            aria-label='Vymazať'\n                                            variant='outline-danger'\n                                            onClick={deleteCategoryHandler.bind(null, category)}\n                                            className='border-0'\n                                        >\n                                            <FontAwesomeIcon icon={faTrash} />\n                                        </Button>\n                                    </Stack>\n                                )}\n                            </td>\n                        </tr>\n                    ))}\n                </tbody>\n            </Table>\n            <Spinner show={isFetchingListOfCategories || isDeleteingCategory} />\n            <Modal\n                show={!!category}\n                type='question'\n                message={`Prajete si vymazať kategóriu \"${category?.name}\" ?`}\n                onClose={deleteCategoryConfirmHandler}\n            />\n            <Modal\n                show={!!error}\n                message={error}\n                type='error'\n                onClose={() => {\n                    setError(undefined);\n                }}\n            />\n        </>\n    );\n};\n\nexport default CategoriesPage;\n"],"names":["CategoriesPage","error","setError","useState","category","setCategory","navigate","useNavigate","queryClient","useQueryClient","authCtx","useContext","AuthContext","listOfCategories","isFetchingListOfCategories","listOfCategoriesError","useQuery","signal","categoryApi","data","a","b","useEffect","formatErrorMessage","message","createCategoryHandler","editCategoryHandler","id","deleteCategoryHandler","deleteCategory","isDeleteingCategory","useMutation","categoryId","categories","old","c","removed","index","context","deleteCategoryConfirmHandler","useCallback","confirmed","jsxs","Fragment","jsx","role","Api","Button","Table","Stack","FontAwesomeIcon","faPencil","faTrash","Spinner","Modal"],"mappings":"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"}