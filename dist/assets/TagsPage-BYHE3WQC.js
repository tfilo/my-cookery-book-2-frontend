import{r as l,u as F,e as M,A as Q,h as S,f as j,j as s,k as v,B as m,S as q,F as p,b as D,c as P,d as R,M as T,t as C}from"./index-Djf207zA.js";import{u as H}from"./useMutation-CYG_XA4X.js";import{T as U}from"./Table-J9FyKPWQ.js";const V=()=>{const[h,d]=l.useState(),[t,x]=l.useState(),g=F(),o=M(),f=l.useContext(Q),{data:c,isFetching:b,error:u}=S({queryKey:["tags"],queryFn:({signal:e})=>C.getTags({signal:e}).then(a=>a.sort((r,n)=>r.name.localeCompare(n.name,void 0,{sensitivity:"base"})))});l.useEffect(()=>{u&&j(u).then(e=>d(e))},[u]);const N=()=>{g("/tag")},k=e=>{g(`/tag/${e}`)},E=e=>{x(e)},{mutate:y,isPending:z}=H({mutationFn:e=>C.deleteTag(e),onMutate:async e=>{await o.cancelQueries({queryKey:["tags"]});const a=o.getQueryData(["tags"]);o.setQueryData(["tags"],i=>i==null?void 0:i.filter(A=>A.id!==e));const r=a==null?void 0:a.find(i=>i.id===e),n=a==null?void 0:a.findIndex(i=>i.id===e);return{removed:r,index:n}},onSuccess:(e,a)=>{o.removeQueries({queryKey:["tags",a]})},onError:(e,a,r)=>{o.setQueryData(["tags"],n=>{if(n&&r&&r.index!==void 0&&r.removed)return[...n.slice(0,r.index),r.removed,...n.slice(r.index)]}),j(e).then(n=>d(n))}}),w=l.useCallback(e=>{e&&t&&y(t.id),x(void 0)},[y,t]);return s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"d-flex flex-column flex-md-row",children:[s.jsx("h1",{className:"flex-grow-1",children:"Značky"}),f.userRoles.find(e=>e===v.User.RoleEnum.ADMIN)&&s.jsx(m,{variant:"primary",onClick:N,children:"Pridať značku"})]}),s.jsxs(U,{striped:!0,responsive:!0,children:[s.jsx("thead",{children:s.jsx("tr",{children:s.jsx("th",{colSpan:2,children:"Názov značky"})})}),s.jsx("tbody",{children:c==null?void 0:c.map(e=>s.jsxs("tr",{children:[s.jsx("td",{className:"align-middle",children:e.name}),s.jsx("td",{className:"align-middle ",children:f.userRoles.find(a=>a===v.User.RoleEnum.ADMIN)&&s.jsxs(q,{direction:"horizontal",gap:2,className:"justify-content-end",children:[s.jsx(m,{title:"Upraviť","aria-label":"Upraviť",variant:"outline-secondary",onClick:k.bind(null,e.id),className:"border-0",children:s.jsx(p,{icon:D})}),s.jsx(m,{title:"Vymazať","aria-label":"Vymazať",variant:"outline-danger",onClick:E.bind(null,e),className:"border-0",children:s.jsx(p,{icon:P})})]})})]},e.id))})]}),s.jsx(R,{show:b||z}),s.jsx(T,{show:!!t,type:"question",message:`Prajete si vymazať značku "${t==null?void 0:t.name}" ?`,onClose:w}),s.jsx(T,{show:!!h,message:h,type:"error",onClose:()=>{d(void 0)}})]})};export{V as default};
//# sourceMappingURL=TagsPage-BYHE3WQC.js.map
