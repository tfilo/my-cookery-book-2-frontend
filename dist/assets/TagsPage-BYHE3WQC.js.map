{"version":3,"file":"TagsPage-BYHE3WQC.js","sources":["../../src/pages/tags/TagsPage.tsx"],"sourcesContent":["import React, { useCallback, useContext, useEffect, useState } from 'react';\nimport { Button, Stack, Table } from 'react-bootstrap';\nimport { useNavigate } from 'react-router-dom';\nimport { faPencil, faTrash } from '@fortawesome/free-solid-svg-icons';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { useMutation, useQuery, useQueryClient } from '@tanstack/react-query';\nimport { Api } from '../../openapi';\nimport { AuthContext } from '../../store/auth-context';\nimport { tagApi } from '../../utils/apiWrapper';\nimport { formatErrorMessage } from '../../utils/errorMessages';\nimport Modal from '../../components/ui/Modal';\nimport Spinner from '../../components/ui/Spinner';\n\nconst TagsPage: React.FC = () => {\n    const [error, setError] = useState<string>();\n    const [tag, setTag] = useState<Api.SimpleTag>();\n    const navigate = useNavigate();\n    const queryClient = useQueryClient();\n    const authCtx = useContext(AuthContext);\n\n    const {\n        data: listOfTags,\n        isFetching: isFetchingListOfTags,\n        error: listOfTagsError\n    } = useQuery({\n        queryKey: ['tags'],\n        queryFn: ({ signal }) =>\n            tagApi.getTags({ signal }).then((data) =>\n                data.sort((a, b) =>\n                    a.name.localeCompare(b.name, undefined, {\n                        sensitivity: 'base'\n                    })\n                )\n            )\n    });\n\n    useEffect(() => {\n        if (listOfTagsError) {\n            formatErrorMessage(listOfTagsError).then((message) => setError(message));\n        }\n    }, [listOfTagsError]);\n\n    const createTagHandler = () => {\n        navigate('/tag');\n    };\n\n    const editTagHandler = (id: number) => {\n        navigate(`/tag/${id}`);\n    };\n\n    const deleteTagHandler = (tag: Api.SimpleTag) => {\n        setTag(tag);\n    };\n\n    const { mutate: deleteTag, isPending: isDeleteingTag } = useMutation({\n        mutationFn: (tagId: number) => tagApi.deleteTag(tagId),\n        onMutate: async (tagId) => {\n            await queryClient.cancelQueries({ queryKey: ['tags'] });\n            const tags = queryClient.getQueryData<Api.SimpleTag[]>(['tags']);\n            queryClient.setQueryData<Api.SimpleTag[]>(['tags'], (old) => old?.filter((t) => t.id !== tagId));\n            const removed = tags?.find((t) => t.id === tagId);\n            const index = tags?.findIndex((t) => t.id === tagId);\n            return {\n                removed,\n                index\n            };\n        },\n        onSuccess: (data, tagId) => {\n            queryClient.removeQueries({\n                queryKey: ['tags', tagId]\n            });\n        },\n        onError: (error, tagId, context) => {\n            queryClient.setQueryData<Api.SimpleTag[]>(['tags'], (old) => {\n                if (old && context && context.index !== undefined && context.removed) {\n                    return [...old.slice(0, context.index), context.removed, ...old.slice(context.index)];\n                }\n                return undefined;\n            });\n            formatErrorMessage(error).then((message) => setError(message));\n        }\n    });\n\n    const deleteTagConfirmHandler = useCallback(\n        (confirmed: boolean) => {\n            if (confirmed) {\n                if (tag) {\n                    deleteTag(tag.id);\n                }\n            }\n            setTag(undefined);\n        },\n        [deleteTag, tag]\n    );\n\n    return (\n        <>\n            <div className='d-flex flex-column flex-md-row'>\n                <h1 className='flex-grow-1'>Značky</h1>\n                {authCtx.userRoles.find((role) => role === Api.User.RoleEnum.ADMIN) && (\n                    <Button\n                        variant='primary'\n                        onClick={createTagHandler}\n                    >\n                        Pridať značku\n                    </Button>\n                )}\n            </div>\n            <Table\n                striped\n                responsive\n            >\n                <thead>\n                    <tr>\n                        <th colSpan={2}>Názov značky</th>\n                    </tr>\n                </thead>\n                <tbody>\n                    {listOfTags?.map((tag) => (\n                        <tr key={tag.id}>\n                            <td className='align-middle'>{tag.name}</td>\n                            <td className='align-middle '>\n                                {authCtx.userRoles.find((role) => role === Api.User.RoleEnum.ADMIN) && (\n                                    <Stack\n                                        direction='horizontal'\n                                        gap={2}\n                                        className='justify-content-end'\n                                    >\n                                        <Button\n                                            title='Upraviť'\n                                            aria-label='Upraviť'\n                                            variant='outline-secondary'\n                                            onClick={editTagHandler.bind(null, tag.id)}\n                                            className='border-0'\n                                        >\n                                            <FontAwesomeIcon icon={faPencil} />\n                                        </Button>\n                                        <Button\n                                            title='Vymazať'\n                                            aria-label='Vymazať'\n                                            variant='outline-danger'\n                                            onClick={deleteTagHandler.bind(null, tag)}\n                                            className='border-0'\n                                        >\n                                            <FontAwesomeIcon icon={faTrash} />\n                                        </Button>\n                                    </Stack>\n                                )}\n                            </td>\n                        </tr>\n                    ))}\n                </tbody>\n            </Table>\n            <Spinner show={isFetchingListOfTags || isDeleteingTag} />\n            <Modal\n                show={!!tag}\n                type='question'\n                message={`Prajete si vymazať značku \"${tag?.name}\" ?`}\n                onClose={deleteTagConfirmHandler}\n            />\n            <Modal\n                show={!!error}\n                message={error}\n                type='error'\n                onClose={() => {\n                    setError(undefined);\n                }}\n            />\n        </>\n    );\n};\n\nexport default TagsPage;\n"],"names":["TagsPage","error","setError","useState","tag","setTag","navigate","useNavigate","queryClient","useQueryClient","authCtx","useContext","AuthContext","listOfTags","isFetchingListOfTags","listOfTagsError","useQuery","signal","tagApi","data","a","b","useEffect","formatErrorMessage","message","createTagHandler","editTagHandler","id","deleteTagHandler","deleteTag","isDeleteingTag","useMutation","tagId","tags","old","t","removed","index","context","deleteTagConfirmHandler","useCallback","confirmed","jsxs","Fragment","jsx","role","Api","Button","Table","Stack","FontAwesomeIcon","faPencil","faTrash","Spinner","Modal"],"mappings":"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"}