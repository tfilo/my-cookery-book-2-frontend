{"version":3,"file":"CategoryPage-KHhpS4X6.js","sources":["../../src/pages/categories/CategoryPage.tsx"],"sourcesContent":["import React, { useState } from 'react';\nimport { useNavigate, useParams } from 'react-router-dom';\nimport { Button, Form, Stack } from 'react-bootstrap';\nimport { useForm, SubmitHandler, FormProvider } from 'react-hook-form';\nimport { yupResolver } from '@hookform/resolvers/yup';\nimport { useMutation, useQueryClient } from '@tanstack/react-query';\nimport * as yup from 'yup';\nimport { Api } from '../../openapi';\nimport { categoryApi } from '../../utils/apiWrapper';\nimport { formatErrorMessage } from '../../utils/errorMessages';\nimport Input from '../../components/ui/Input';\nimport Modal from '../../components/ui/Modal';\nimport Spinner from '../../components/ui/Spinner';\n\ntype CategoryForm = Api.CreateCategory | Api.UpdateCategory;\n\nconst schema = yup\n    .object({\n        name: yup.string().trim().min(1, 'Musí byť minimálne 1 znak').max(50, 'Musí byť maximálne 50 znakov').required('Povinná položka')\n    })\n    .required();\n\nconst CategoryPage: React.FC = () => {\n    const [error, setError] = useState<string>();\n    const navigate = useNavigate();\n    const params = useParams();\n    const queryClient = useQueryClient();\n\n    const methods = useForm<CategoryForm>({\n        resolver: yupResolver(schema),\n        defaultValues: async () => {\n            if (params.id) {\n                try {\n                    const data = await queryClient.fetchQuery({\n                        queryKey: ['categories', parseInt(params?.id)] as const,\n                        queryFn: ({ queryKey, signal }) => {\n                            return categoryApi.getCategory(queryKey[1], { signal });\n                        }\n                    });\n                    return data;\n                } catch (e) {\n                    formatErrorMessage(e).then((message) => setError(message));\n                }\n            }\n            return {\n                name: ''\n            };\n        }\n    });\n\n    const {\n        formState: { isSubmitting, isLoading }\n    } = methods;\n\n    const cancelHandler = () => {\n        navigate('/categories');\n    };\n\n    const { mutate: saveCategory, isPending: isSaving } = useMutation({\n        mutationFn: ({ data, categoryId }: { data: CategoryForm; categoryId?: number }) => {\n            if (categoryId) {\n                return categoryApi.updateCategory(categoryId, data);\n            } else {\n                return categoryApi.createCategory(data);\n            }\n        },\n        onMutate: async () => {\n            await queryClient.cancelQueries({ queryKey: ['categories'] });\n        },\n        onSettled: async (data, error) => {\n            if (error) {\n                formatErrorMessage(error).then((message) => setError(message));\n            } else if (data) {\n                queryClient.setQueryData<Api.Category>(['categories', data.id], () => data);\n                queryClient.setQueryData<Api.SimpleCategory[]>(['categories'], (categories) => {\n                    const index = categories?.findIndex((c) => c.id === data.id) ?? -1;\n                    if (index > -1) {\n                        const result = [...(categories ?? [])];\n                        result[index] = {\n                            id: data.id,\n                            name: data.name\n                        };\n                        return result.sort((a, b) =>\n                            a.name.localeCompare(b.name, undefined, {\n                                sensitivity: 'base'\n                            })\n                        );\n                    } else {\n                        const result = [\n                            ...(categories ?? []),\n                            {\n                                id: data.id,\n                                name: data.name\n                            }\n                        ];\n                        return result.sort((a, b) =>\n                            a.name.localeCompare(b.name, undefined, {\n                                sensitivity: 'base'\n                            })\n                        );\n                    }\n                });\n                navigate('/categories');\n            }\n        }\n    });\n\n    const submitHandler: SubmitHandler<CategoryForm> = (data: CategoryForm) => {\n        saveCategory({\n            data,\n            categoryId: params.id ? parseInt(params.id) : undefined\n        });\n    };\n\n    return (\n        <div className='row justify-content-center'>\n            <div className='col-lg-6 pt-3'>\n                <h1>Kategória</h1>\n                <FormProvider {...methods}>\n                    <Form\n                        noValidate\n                        onSubmit={methods.handleSubmit(submitHandler)}\n                    >\n                        <Input\n                            name='name'\n                            label='Kategória'\n                        />\n                        <Stack\n                            direction='horizontal'\n                            gap={2}\n                        >\n                            <Button\n                                variant='primary'\n                                type='submit'\n                            >\n                                {params.id ? 'Zmeniť kategóriu' : 'Vytvoriť kategóriu'}\n                            </Button>{' '}\n                            <Button\n                                variant='warning'\n                                type='button'\n                                onClick={cancelHandler}\n                            >\n                                Zrušiť\n                            </Button>\n                        </Stack>\n                    </Form>\n                </FormProvider>\n            </div>\n            <Modal\n                show={!!error}\n                message={error}\n                type='error'\n                onClose={() => {\n                    setError(undefined);\n                }}\n            />\n            <Spinner show={isSubmitting || isLoading || isSaving} />\n        </div>\n    );\n};\n\nexport default CategoryPage;\n"],"names":["schema","yup.object","yup.string","CategoryPage","error","setError","useState","navigate","useNavigate","params","useParams","queryClient","useQueryClient","methods","useForm","yupResolver","queryKey","signal","categoryApi","formatErrorMessage","message","isSubmitting","isLoading","cancelHandler","saveCategory","isSaving","useMutation","data","categoryId","categories","index","c","result","a","b","submitHandler","jsxs","jsx","FormProvider","Form","Input","Stack","Button","Modal","Spinner"],"mappings":"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"}