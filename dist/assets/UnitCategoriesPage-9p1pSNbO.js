import{r,u as w,e as P,A,h as I,f as b,i as $,j as t,k as F,S as Q,B as h,F as U,b as M,c as H,M as E,l as L,d as V,m as D}from"./index-Djf207zA.js";import{u as R}from"./useMutation-CYG_XA4X.js";import{T as B}from"./Table-J9FyKPWQ.js";const T=k=>{const[y,o]=r.useState(),[l,p]=r.useState(),N=w(),{unitCategoryId:d,setIsLoading:u}=k,m=P(),j=r.useContext(A),{data:x,isFetching:g,error:f}=I({queryKey:["unitcategories",d,"units"],queryFn:({queryKey:n,signal:e})=>$.getUnitsByUnitCategory(n[1],{signal:e}).then(i=>i.sort((s,a)=>s.name.localeCompare(a.name,void 0,{sensitivity:"base"})))});r.useEffect(()=>{f&&b(f).then(n=>o(n))},[f]);const S=n=>{N(`/unit/${d}/${n}`)},q=n=>{p(n)},{mutate:C,isPending:v}=R({mutationFn:n=>$.deleteUnit(n),onMutate:async n=>{await m.cancelQueries({queryKey:["unitcategories",d,"units"]});const e=m.getQueryData(["unitcategories",d,"units"]);m.setQueryData(["unitcategories",d,"units"],a=>a==null?void 0:a.filter(c=>c.id!==n));const i=e==null?void 0:e.find(a=>a.id===n),s=e==null?void 0:e.findIndex(a=>a.id===n);return{removed:i,index:s}},onSuccess:(n,e)=>{m.removeQueries({queryKey:["unitcategories",d,"units",e]})},onError:(n,e,i)=>{m.setQueryData(["unitcategories",d,"units"],s=>{if(s&&i&&i.index!==void 0&&i.removed)return[...s.slice(0,i.index),i.removed,...s.slice(i.index)]}),b(n).then(s=>o(s))}}),z=r.useCallback(n=>{n&&l&&C(l.id),p(void 0)},[l,C]);return r.useEffect(()=>{u(g||v)},[u,g,v]),t.jsxs(t.Fragment,{children:[t.jsx("tbody",{children:x==null?void 0:x.map(n=>t.jsxs("tr",{children:[t.jsx("td",{className:"align-middle",children:n.name}),t.jsx("td",{className:"align-middle",children:n.abbreviation}),j.userRoles.find(e=>e===F.User.RoleEnum.ADMIN)&&t.jsxs(Q,{as:"td",direction:"horizontal",gap:2,className:"justify-content-end",children:[t.jsx(h,{title:"Upraviť","aria-label":"Upraviť",variant:"outline-secondary",onClick:S.bind(null,n.id),className:"border-0",children:t.jsx(U,{icon:M})}),t.jsx(h,{title:"Vymazať","aria-label":"Vymazať",variant:"outline-danger",onClick:q.bind(null,n),className:"border-0",children:t.jsx(U,{icon:H})})]})]},n.id))}),t.jsx(E,{show:!!l,type:"question",message:`Prajete si vymazať značku "${l==null?void 0:l.name}" ?`,onClose:z}),t.jsx(E,{show:!!y,message:y,type:"error",onClose:()=>{o(void 0)}})]})},W=()=>{const[k,y]=r.useState(),[o,l]=r.useState(),[p,N]=r.useState(!1),d=w(),u=P(),m=r.useContext(A),{data:j,isFetching:x,error:g}=I({queryKey:["unitcategories"],queryFn:({signal:e})=>D.getUnitCategories({signal:e}).then(i=>i.sort((s,a)=>s.name.localeCompare(a.name,void 0,{sensitivity:"base"})))});r.useEffect(()=>{g&&b(g).then(e=>y(e))},[g]);const f=()=>{d("/unitCategory")},S=e=>{d(`/unit/${e}`)},q=e=>{d(`/unitCategory/${e}`)},C=e=>{l(e)},{mutate:v,isPending:z}=R({mutationFn:e=>D.deleteUnitCategory(e),onMutate:async e=>{await u.cancelQueries({queryKey:["unitcategories"]});const i=u.getQueryData(["unitcategories"]);u.setQueryData(["unitcategories"],c=>c==null?void 0:c.filter(K=>K.id!==e));const s=i==null?void 0:i.find(c=>c.id===e),a=i==null?void 0:i.findIndex(c=>c.id===e);return{removed:s,index:a}},onSuccess:(e,i)=>{u.removeQueries({queryKey:["unitcategories",i]})},onError:(e,i,s)=>{u.setQueryData(["unitcategories"],a=>{if(a&&s&&s.index!==void 0&&s.removed)return[...a.slice(0,s.index),s.removed,...a.slice(s.index)]}),b(e).then(a=>y(a))}}),n=r.useCallback(e=>{e&&o&&v(o.id),l(void 0)},[v,o]);return t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"d-flex flex-column flex-md-row",children:[t.jsx("h1",{className:"flex-grow-1",children:"Jednotky"}),m.userRoles.find(e=>e===F.User.RoleEnum.ADMIN)&&t.jsx(h,{variant:"primary",onClick:f,children:"Pridať kategóriu jednotky"})]}),t.jsx("div",{children:j==null?void 0:j.map(e=>t.jsxs(B,{striped:!0,responsive:!0,children:[t.jsxs("thead",{children:[t.jsx("tr",{children:t.jsxs(Q,{as:"th",className:"border-0",colSpan:3,direction:"horizontal",gap:2,children:[e.name,m.userRoles.find(i=>i===F.User.RoleEnum.ADMIN)&&t.jsxs(Q,{className:"border-0",direction:"horizontal",gap:2,children:[t.jsx(h,{title:`Pridať kategóriu jednotky ${e.name}`,"aria-label":`Pridať kategóriu jednotky ${e.name}`,variant:"outline-success",type:"button",onClick:S.bind(null,e.id),children:t.jsx(U,{icon:L})}),t.jsx(h,{title:`Upraviť kategóriu jednotky ${e.name}`,"aria-label":`Upraviť kategóriu jednotky ${e.name}`,variant:"outline-secondary",onClick:q.bind(null,e.id),children:t.jsx(U,{icon:M})}),t.jsx(h,{title:`Vymazať kategóriu jednotky ${e.name}`,"aria-label":`Vymazať kategóriu jednotky ${e.name}`,variant:"outline-danger",onClick:C.bind(null,e),children:t.jsx(U,{icon:H})})]})]})}),t.jsxs("tr",{children:[t.jsx("th",{children:"Názov jednotky"}),t.jsx("th",{colSpan:2,children:"Skratka jednotky"})]})]}),t.jsx(T,{unitCategoryId:e.id,setIsLoading:N})]},e.id))}),t.jsx(V,{show:z||p||x}),t.jsx(E,{show:!!o,type:"question",message:`Prajete si vymazať značku "${o==null?void 0:o.name}" ?`,onClose:n}),t.jsx(E,{show:!!k,message:k,type:"error",onClose:()=>{y(void 0)}})]})};export{W as default};
//# sourceMappingURL=UnitCategoriesPage-9p1pSNbO.js.map
